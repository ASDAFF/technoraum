(function(){var BX=window.BX;BX.namespace("BX.UI");if(!!BX.UI.Tooltip){return}BX.UI.Tooltip={disabled:false,tooltipsList:{},disable:function(){this.disabled=true},enable:function(){this.disabled=false},getDisabledStatus:function(){return this.disabled},getLoader:function(){return"/bitrix/tools/tooltip.php"},getIdPrefix:function(){return"bx-ui-tooltip-"}};BX.ready(function(){if(BX.browser.IsAndroid()||BX.browser.IsIOS()){return}document.addEventListener("mouseover",function(t){var i=BX.getEventTarget(t);var o=i.getAttribute("bx-tooltip-user-id");var e=i.getAttribute("bx-tooltip-loader");var s=o;if(BX.type.isNotEmptyString(e)){var a=0;for(var r=0,l=e.length;r<l;r++){a=31*a+e.charCodeAt(r)<<0}s=a+o}if(BX.type.isNotEmptyString(o)){if(null==BX.UI.Tooltip.tooltipsList[s]){BX.UI.Tooltip.tooltipsList[s]=new BX.UI.TooltipBalloon({userId:o,node:i,loader:e})}else{BX.UI.Tooltip.tooltipsList[s].node=i;BX.UI.Tooltip.tooltipsList[s].create()}t.preventDefault()}})});BX.UI.TooltipBalloon=function(t){this.node=t.node;this.userId=t.userId;this.loader=BX.type.isNotEmptyString(t.loader)?t.loader:"";this.tracking=false;this.active=false;this.width=364;this.height=215;this.realAnchor=null;this.coordsLeft=0;this.coordsTop=0;this.anchorRight=0;this.anchorTop=0;this.hMirror=false;this.vMirror=false;this.rootClassName=this.node.getAttribute("bx-tooltip-classname");this.INFO=null;this.DIV=null;this.ROOT_DIV=null;var i={};var o=this.node.getAttribute("bx-tooltip-params");if(BX.type.isNotEmptyString(o)){i=JSON.parse(o);if(!BX.type.isPlainObject(i)){i={}}}this.params=i;this.create=function(){if(!BX.UI.Tooltip.getDisabledStatus()){this.startTrackMouse()}BX.bind(this.node,"mouseout",BX.delegate(this.stopTrackMouse,this))};this.trackMouseHandle=this.trackMouse.bind(this);this.create();return this};BX.UI.TooltipBalloon.prototype.startTrackMouse=function(){if(!this.tracking){var t=this;var i=BX.pos(this.node);this.realAnchor=this.node;this.coordsLeft=i.left+0;this.coordsTop=i.top-245;this.anchorRight=i.right;this.anchorTop=i.top;this.tracking=true;BX.bind(document,"mousemove",this.trackMouseHandle);setTimeout(BX.delegate(function(){this.tickTimer()},this),500);BX.bind(this.node,"mouseout",BX.delegate(this.stopTrackMouse,this))}};BX.UI.TooltipBalloon.prototype.stopTrackMouse=function(){if(this.tracking){var t=this;BX.unbind(document,"mousemove",this.trackMouseHandle);this.active=false;setTimeout(BX.delegate(function(){this.hideTooltip()},this),500);this.tracking=false}};BX.UI.TooltipBalloon.prototype.trackMouse=function(t){if(!this.tracking){return}var i=t&&t.pageX?{x:t.pageX,y:t.pageY}:{x:t.clientX+document.body.scrollLeft,y:t.clientY+document.body.scrollTop};if(i.x<0){i.x=0}if(i.y<0){i.y=0}i.time=this.tracking;if(!this.active){this.active=i}else{if(this.active.x>=i.x-1&&this.active.x<=i.x+1&&this.active.y>=i.y-1&&this.active.y<=i.y+1){if(this.active.time+20<=i.time){this.showTooltip()}}else{this.active=i}}};BX.UI.TooltipBalloon.prototype.tickTimer=function(){var t=this;if(t.tracking){t.tracking++;if(t.active){if(t.active.time+5<=t.tracking){t.showTooltip()}}setTimeout(function(){t.tickTimer()},100)}};BX.UI.TooltipBalloon.prototype.hideTooltip=function(){if(!this.tracking){this.showOpacityEffect(1)}};BX.UI.TooltipBalloon.prototype.showOpacityEffect=function(t){var i=3;var o=1;var e=1/i;var s=0,a,r=this;var l=function(){s++;if(s>i){clearInterval(n);return}a=t?1-s*e:s*e;if(r.DIV!=null){try{r.DIV.style.opacity=a}catch(t){}finally{if(!t&&s==1){r.DIV.classList.add("ui-tooltip-info-shadow-show");r.DIV.style.display="block"}if(t&&s==i&&r.DIV){r.DIV.classList.remove("ui-tooltip-info-shadow-show");r.DIV.classList.add("ui-tooltip-info-shadow-hide");setTimeout(BX.delegate(function(){r.DIV.style.display="none"},this),500)}if(t){BX.onCustomEvent("onTooltipHide",[r])}}}};var n=setInterval(l,o)};BX.UI.TooltipBalloon.prototype.showTooltip=function(){var t=this;var i=BX(BX.UI.Tooltip.getIdPrefix()+t.userId);if(BX.UI.Tooltip.getDisabledStatus()||i&&i.classList.contains("ui-tooltip-info-shadow-show")){return}if(null==t.DIV&&null==t.ROOT_DIV){t.ROOT_DIV=document.body.appendChild(document.createElement("DIV"));t.ROOT_DIV.style.position="absolute";t.DIV=t.ROOT_DIV.appendChild(document.createElement("DIV"));t.DIV.className="bx-ui-tooltip-info-shadow";t.DIV.style.width=t.width+"px"}var o=t.coordsLeft;var e=t.coordsTop+30;var s=BX.GetWindowScrollPos();var a=document.body;t.hMirror=false;t.vMirror=e-s.scrollTop<0;if(a.clientWidth+s.scrollLeft<o+t.width){o=t.anchorRight-t.width;t.hMirror=true}t.ROOT_DIV.style.left=parseInt(o)+"px";t.ROOT_DIV.style.top=parseInt(e)+"px";t.ROOT_DIV.style.zIndex=3200;BX.bind(BX(t.ROOT_DIV),"click",BX.eventCancelBubble);if(BX.type.isNotEmptyString(this.rootClassName)){t.ROOT_DIV.className=this.rootClassName}var r=BX.type.isNotEmptyString(t.loader)?t.loader:BX.UI.Tooltip.getLoader();var l=false;if(""==t.DIV.innerHTML){l=true;var n=r+(r.indexOf("?")>=0?"&":"?")+"MODE=UI&MUL_MODE=INFO&USER_ID="+t.userId+"&site="+(BX.message("SITE_ID")||"")+"&version=2"+(typeof t.params!="undefined"&&typeof t.params.entityType!="undefined"&&t.params.entityType.length>0?"&entityType="+t.params.entityType:"")+(typeof t.params!="undefined"&&typeof t.params.entityId!="undefined"&&parseInt(t.params.entityId)>0?"&entityId="+parseInt(t.params.entityId):"");BX.ajax.get(n,BX.proxy(function(i){t.insertData(i);t.adjustPosition()},t));t.DIV.id=BX.UI.Tooltip.getIdPrefix()+t.userId;t.DIV.innerHTML='<div class="bx-ui-tooltip-info-wrap">'+'<div class="bx-ui-tooltip-info-leftcolumn">'+'<div class="bx-ui-tooltip-photo" id="'+BX.UI.Tooltip.getIdPrefix()+"photo-"+t.userId+'"><div class="bx-ui-tooltip-info-data-loading">'+BX.message("JS_CORE_LOADING")+"</div></div>"+"</div>"+'<div class="bx-ui-tooltip-info-data">'+'<div id="'+BX.UI.Tooltip.getIdPrefix()+"data-card-"+t.userId+'"></div>'+'<div class="bx-ui-tooltip-info-data-tools">'+'<div class="bx-ui-tooltip-tb-control bx-ui-tooltip-tb-control-left" id="'+BX.UI.Tooltip.getIdPrefix()+"toolbar-"+t.userId+'"></div>'+'<div class="bx-ui-tooltip-tb-control bx-ui-tooltip-tb-control-right" id="'+BX.UI.Tooltip.getIdPrefix()+"toolbar2-"+t.userId+'"></div>'+'<div class="bx-ui-tooltip-info-data-clear"></div>'+"</div>"+"</div>"+'</div><div class="bx-ui-tooltip-info-bottomarea"></div>'}t.DIV.className="bx-ui-tooltip-info-shadow";t.classNameAnim="bx-ui-tooltip-info-shadow-anim";t.classNameFixed="bx-ui-tooltip-info-shadow";if(t.hMirror&&t.vMirror){t.DIV.className="bx-ui-tooltip-info-shadow-hv";t.classNameAnim="bx-ui-tooltip-info-shadow-hv-anim";t.classNameFixed="bx-ui-tooltip-info-shadow-hv"}else{if(t.hMirror){t.DIV.className="bx-ui-tooltip-info-shadow-h";t.classNameAnim="bx-ui-tooltip-info-shadow-h-anim";t.classNameFixed="bx-ui-tooltip-info-shadow-h"}if(t.vMirror){t.DIV.className="bx-ui-tooltip-info-shadow-v";t.classNameAnim="bx-ui-tooltip-info-shadow-v-anim";t.classNameFixed="bx-ui-tooltip-info-shadow-v"}}t.DIV.style.display="block";if(!l){t.adjustPosition()}t.showOpacityEffect(0);BX(BX.UI.Tooltip.getIdPrefix()+t.userId).onmouseover=function(){t.startTrackMouse(this)};BX(BX.UI.Tooltip.getIdPrefix()+t.userId).onmouseout=function(){t.stopTrackMouse(this)};BX.onCustomEvent("onTooltipShow",[this])};BX.UI.TooltipBalloon.prototype.adjustPosition=function(){var t=BX.pos(this.DIV);if(this.vMirror){this.ROOT_DIV.style.top=parseInt(this.anchorTop+13)+"px"}else{this.ROOT_DIV.style.top=parseInt(this.anchorTop-t.height-13+35)+"px"}};BX.UI.TooltipBalloon.prototype.insertData=function(data){var _this=this;if(null!=data&&data.length>0){eval("_this.INFO = "+data);var cardEl=BX(BX.UI.Tooltip.getIdPrefix()+"data-card-"+_this.userId);cardEl.innerHTML="";if(BX.type.isNotEmptyString(_this.INFO.RESULT.Name)){cardEl.innerHTML+='<div class="bx-ui-tooltip-user-name">'+_this.INFO.RESULT.Name+"</div>"}if(BX.type.isNotEmptyString(_this.INFO.RESULT.Position)){cardEl.innerHTML+='<div class="bx-ui-tooltip-user-position">'+_this.INFO.RESULT.Position+"</div>"}cardEl.innerHTML+=_this.INFO.RESULT.Card;var photoEl=BX(BX.UI.Tooltip.getIdPrefix()+"photo-"+_this.userId);photoEl.innerHTML=_this.INFO.RESULT.Photo;var toolbarEl=BX(BX.UI.Tooltip.getIdPrefix()+"toolbar-"+_this.userId);toolbarEl.innerHTML=_this.INFO.RESULT.Toolbar;var toolbar2El=BX(BX.UI.Tooltip.getIdPrefix()+"toolbar2-"+_this.userId);toolbar2El.innerHTML=_this.INFO.RESULT.Toolbar2;if(BX.type.isArray(_this.INFO.RESULT.Scripts)){for(var i=0;i<_this.INFO.RESULT.Scripts.length;i++){eval(_this.INFO.RESULT.Scripts[i])}}BX.onCustomEvent("onTooltipInsertData",[_this])}}})();